import pandas as pd

from app.services.indicators_service import calculate_simple_moving_average, calculate_exponential_moving_average, \
    calculate_rsi, calculate_macd, calculate_bollinger_bands
from app.utils import clean_stock_data
from config import DATA_DIR


def test_sma_ramasteel_manual():
    input_path = DATA_DIR / "stocks_ohlc_data.parquet"

    df = pd.read_parquet(input_path)
    df = clean_stock_data(df)
    test_output = calculate_simple_moving_average(
        df=df,
        stock_symbol='RAMASTEEL',
        ma_period=20,
        start_date='2022-07-22',
        end_date='2022-12-31'
    )

    # Expected output based on previous print
    expected = [{'symbol': 'RAMASTEEL', 'date': '2022-07-22', 'sma': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-25', 'sma': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-26', 'sma': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-27', 'sma': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-28', 'sma': 2136.515008}, {'symbol': 'RAMASTEEL', 'date': '2022-07-29', 'sma': 2164.535007}, {'symbol': 'RAMASTEEL', 'date': '2022-08-01', 'sma': 815.387507}, {'symbol': 'RAMASTEEL', 'date': '2022-08-02', 'sma': 987.325007}, {'symbol': 'RAMASTEEL', 'date': '2022-08-03', 'sma': 1098.145006}, {'symbol': 'RAMASTEEL', 'date': '2022-08-04', 'sma': 1207.3100005000001}, {'symbol': 'RAMASTEEL', 'date': '2022-08-05', 'sma': 1141.3650005}, {'symbol': 'RAMASTEEL', 'date': '2022-08-08', 'sma': 1390.9799905}, {'symbol': 'RAMASTEEL', 'date': '2022-08-10', 'sma': 1471.2399905}, {'symbol': 'RAMASTEEL', 'date': '2022-08-11', 'sma': 1358.64498555}, {'symbol': 'RAMASTEEL', 'date': '2022-08-12', 'sma': 1479.67748555}, {'symbol': 'RAMASTEEL', 'date': '2022-08-16', 'sma': 1500.65998655}, {'symbol': 'RAMASTEEL', 'date': '2022-08-17', 'sma': 1525.9099850500002}, {'symbol': 'RAMASTEEL', 'date': '2022-08-18', 'sma': 1501.6874845500001}, {'symbol': 'RAMASTEEL', 'date': '2022-08-19', 'sma': 1432.71998455}, {'symbol': 'RAMASTEEL', 'date': '2022-08-22', 'sma': 1371.80248455}, {'symbol': 'RAMASTEEL', 'date': '2022-08-23', 'sma': 1471.0899840499999}, {'symbol': 'RAMASTEEL', 'date': '2022-08-24', 'sma': 1495.88998555}, {'symbol': 'RAMASTEEL', 'date': '2022-08-25', 'sma': 1498.89498555}, {'symbol': 'RAMASTEEL', 'date': '2022-08-26', 'sma': 1470.94248555}, {'symbol': 'RAMASTEEL', 'date': '2022-08-29', 'sma': 1394.1999855499998}, {'symbol': 'RAMASTEEL', 'date': '2022-08-30', 'sma': 1709.41498555}, {'symbol': 'RAMASTEEL', 'date': '2022-09-01', 'sma': 1719.1924855499997}, {'symbol': 'RAMASTEEL', 'date': '2022-09-02', 'sma': 1563.67248455}, {'symbol': 'RAMASTEEL', 'date': '2022-09-05', 'sma': 1437.6999850500001}, {'symbol': 'RAMASTEEL', 'date': '2022-09-06', 'sma': 1371.83999005}, {'symbol': 'RAMASTEEL', 'date': '2022-09-07', 'sma': 1388.59749005}, {'symbol': 'RAMASTEEL', 'date': '2022-09-08', 'sma': 1214.82500005}, {'symbol': 'RAMASTEEL', 'date': '2022-09-09', 'sma': 1125.06500055}, {'symbol': 'RAMASTEEL', 'date': '2022-09-12', 'sma': 1160.1700005}, {'symbol': 'RAMASTEEL', 'date': '2022-09-13', 'sma': 998.5675014999999}, {'symbol': 'RAMASTEEL', 'date': '2022-09-14', 'sma': 958.8800010000001}, {'symbol': 'RAMASTEEL', 'date': '2022-09-15', 'sma': 933.250002}, {'symbol': 'RAMASTEEL', 'date': '2022-09-16', 'sma': 921.4200020999999}, {'symbol': 'RAMASTEEL', 'date': '2022-09-19', 'sma': 1041.0600071000001}, {'symbol': 'RAMASTEEL', 'date': '2022-09-20', 'sma': 1102.7800071}, {'symbol': 'RAMASTEEL', 'date': '2022-09-21', 'sma': 1004.0600066}, {'symbol': 'RAMASTEEL', 'date': '2022-09-22', 'sma': 1009.7550051000001}, {'symbol': 'RAMASTEEL', 'date': '2022-09-23', 'sma': 1026.4775051000001}, {'symbol': 'RAMASTEEL', 'date': '2022-09-26', 'sma': 1049.4400051}, {'symbol': 'RAMASTEEL', 'date': '2022-09-27', 'sma': 1050.6980050500001}, {'symbol': 'RAMASTEEL', 'date': '2022-09-28', 'sma': 713.3355040499999}, {'symbol': 'RAMASTEEL', 'date': '2022-09-29', 'sma': 719.09300405}, {'symbol': 'RAMASTEEL', 'date': '2022-09-30', 'sma': 764.23800505}, {'symbol': 'RAMASTEEL', 'date': '2022-10-03', 'sma': 853.37300455}, {'symbol': 'RAMASTEEL', 'date': '2022-10-04', 'sma': 818.23050455}, {'symbol': 'RAMASTEEL', 'date': '2022-10-06', 'sma': 802.5405044500001}, {'symbol': 'RAMASTEEL', 'date': '2022-10-07', 'sma': 725.38900445}, {'symbol': 'RAMASTEEL', 'date': '2022-10-10', 'sma': 761.20150295}, {'symbol': 'RAMASTEEL', 'date': '2022-10-11', 'sma': 752.47650245}, {'symbol': 'RAMASTEEL', 'date': '2022-10-12', 'sma': 804.2740014499999}, {'symbol': 'RAMASTEEL', 'date': '2022-10-13', 'sma': 833.90650145}, {'symbol': 'RAMASTEEL', 'date': '2022-10-14', 'sma': 906.54150145}, {'symbol': 'RAMASTEEL', 'date': '2022-10-17', 'sma': 1377.9840013500002}, {'symbol': 'RAMASTEEL', 'date': '2022-10-18', 'sma': 1488.44899135}, {'symbol': 'RAMASTEEL', 'date': '2022-10-19', 'sma': 1466.0139913500002}, {'symbol': 'RAMASTEEL', 'date': '2022-10-20', 'sma': 1560.85149185}, {'symbol': 'RAMASTEEL', 'date': '2022-10-21', 'sma': 1522.6014923500002}, {'symbol': 'RAMASTEEL', 'date': '2022-10-25', 'sma': 1502.49149235}, {'symbol': 'RAMASTEEL', 'date': '2022-10-27', 'sma': 1479.7402426}, {'symbol': 'RAMASTEEL', 'date': '2022-10-28', 'sma': 1485.04474265}, {'symbol': 'RAMASTEEL', 'date': '2022-10-31', 'sma': 1460.9397436499999}, {'symbol': 'RAMASTEEL', 'date': '2022-11-01', 'sma': 1566.91474365}, {'symbol': 'RAMASTEEL', 'date': '2022-11-02', 'sma': 1578.52974365}, {'symbol': 'RAMASTEEL', 'date': '2022-11-03', 'sma': 1541.67599365}, {'symbol': 'RAMASTEEL', 'date': '2022-11-04', 'sma': 1520.95349315}, {'symbol': 'RAMASTEEL', 'date': '2022-11-07', 'sma': 1518.1034932500002}, {'symbol': 'RAMASTEEL', 'date': '2022-11-09', 'sma': 1515.6392433}, {'symbol': 'RAMASTEEL', 'date': '2022-11-10', 'sma': 1529.0642443000002}, {'symbol': 'RAMASTEEL', 'date': '2022-11-11', 'sma': 1517.6417453000001}, {'symbol': 'RAMASTEEL', 'date': '2022-11-14', 'sma': 1442.4442454}, {'symbol': 'RAMASTEEL', 'date': '2022-11-15', 'sma': 1441.0267454}, {'symbol': 'RAMASTEEL', 'date': '2022-11-16', 'sma': 1383.4367449}, {'symbol': 'RAMASTEEL', 'date': '2022-11-17', 'sma': 914.5712449}, {'symbol': 'RAMASTEEL', 'date': '2022-11-18', 'sma': 669.8402499}, {'symbol': 'RAMASTEEL', 'date': '2022-11-21', 'sma': 1095.5177598999999}, {'symbol': 'RAMASTEEL', 'date': '2022-11-22', 'sma': 990.3952604}, {'symbol': 'RAMASTEEL', 'date': '2022-11-23', 'sma': 987.8952605499999}, {'symbol': 'RAMASTEEL', 'date': '2022-11-24', 'sma': 974.3747605499999}, {'symbol': 'RAMASTEEL', 'date': '2022-11-25', 'sma': 992.0110103}, {'symbol': 'RAMASTEEL', 'date': '2022-11-28', 'sma': 1042.9785103}, {'symbol': 'RAMASTEEL', 'date': '2022-11-29', 'sma': 1036.8510101499999}, {'symbol': 'RAMASTEEL', 'date': '2022-11-30', 'sma': 918.7660101499999}, {'symbol': 'RAMASTEEL', 'date': '2022-12-01', 'sma': 1180.25101015}, {'symbol': 'RAMASTEEL', 'date': '2022-12-02', 'sma': 1156.96976015}, {'symbol': 'RAMASTEEL', 'date': '2022-12-05', 'sma': 1157.0722606499999}, {'symbol': 'RAMASTEEL', 'date': '2022-12-06', 'sma': 1176.33726065}, {'symbol': 'RAMASTEEL', 'date': '2022-12-07', 'sma': 1182.9042605999998}, {'symbol': 'RAMASTEEL', 'date': '2022-12-08', 'sma': 1141.9892600999997}, {'symbol': 'RAMASTEEL', 'date': '2022-12-09', 'sma': 1409.0792546}, {'symbol': 'RAMASTEEL', 'date': '2022-12-12', 'sma': 1529.7242545000001}, {'symbol': 'RAMASTEEL', 'date': '2022-12-13', 'sma': 1530.784255}, {'symbol': 'RAMASTEEL', 'date': '2022-12-14', 'sma': 1567.5892555}, {'symbol': 'RAMASTEEL', 'date': '2022-12-15', 'sma': 1573.9522554999999}, {'symbol': 'RAMASTEEL', 'date': '2022-12-16', 'sma': 1729.9632555}, {'symbol': 'RAMASTEEL', 'date': '2022-12-19', 'sma': 1264.6152455}, {'symbol': 'RAMASTEEL', 'date': '2022-12-20', 'sma': 1284.987745}, {'symbol': 'RAMASTEEL', 'date': '2022-12-21', 'sma': 1319.83274535}, {'symbol': 'RAMASTEEL', 'date': '2022-12-22', 'sma': 1429.2957453499998}, {'symbol': 'RAMASTEEL', 'date': '2022-12-23', 'sma': 1449.80324535}, {'symbol': 'RAMASTEEL', 'date': '2022-12-26', 'sma': 1420.55074435}, {'symbol': 'RAMASTEEL', 'date': '2022-12-27', 'sma': 1423.1182445}, {'symbol': 'RAMASTEEL', 'date': '2022-12-28', 'sma': 1430.9594945}, {'symbol': 'RAMASTEEL', 'date': '2022-12-29', 'sma': 1165.0744945000001}, {'symbol': 'RAMASTEEL', 'date': '2022-12-30', 'sma': 1122.3819945}]

    # Round for float comparison safety
    actual = test_output.round(2).to_dict(orient="records")
    try:
        assert actual[:len(expected)] == expected
    except AssertionError as e:
        print("Assertion failed:", e)
        raise  # Optional: re-raise the error

def test_ema_ramasteel_manual():
    input_path = DATA_DIR / "stocks_ohlc_data.parquet"

    df = pd.read_parquet(input_path)
    df = clean_stock_data(df)
    test_output =  calculate_exponential_moving_average(
        df=df,
        stock_symbol='RAMASTEEL',
        ema_period=20,
        start_date='2022-07-22',
        end_date='2022-12-31'
    )

    # Expected output based on previous print
    expected = [{'symbol': 'RAMASTEEL', 'date': '2022-07-22', 'ema': 1435.602334282302}, {'symbol': 'RAMASTEEL', 'date': '2022-07-25', 'ema': 1325.1783014935113}, {'symbol': 'RAMASTEEL', 'date': '2022-07-26', 'ema': 1244.0327489703197}, {'symbol': 'RAMASTEEL', 'date': '2022-07-27', 'ema': 1210.201058592194}, {'symbol': 'RAMASTEEL', 'date': '2022-07-28', 'ema': 1243.7676244405566}, {'symbol': 'RAMASTEEL', 'date': '2022-07-29', 'ema': 1232.032612589075}, {'symbol': 'RAMASTEEL', 'date': '2022-08-01', 'ema': 1143.7485542472582}, {'symbol': 'RAMASTEEL', 'date': '2022-08-02', 'ema': 1382.0105966999001}, {'symbol': 'RAMASTEEL', 'date': '2022-08-03', 'ema': 1519.3714922522906}, {'symbol': 'RAMASTEEL', 'date': '2022-08-04', 'ema': 1620.1837215615965}, {'symbol': 'RAMASTEEL', 'date': '2022-08-05', 'ema': 1471.5947956985874}, {'symbol': 'RAMASTEEL', 'date': '2022-08-08', 'ema': 1817.7809865844363}, {'symbol': 'RAMASTEEL', 'date': '2022-08-10', 'ema': 1828.7827973859185}, {'symbol': 'RAMASTEEL', 'date': '2022-08-11', 'ema': 1656.3463405872596}, {'symbol': 'RAMASTEEL', 'date': '2022-08-12', 'ema': 1859.4514510075205}, {'symbol': 'RAMASTEEL', 'date': '2022-08-16', 'ema': 1772.7846471020425}, {'symbol': 'RAMASTEEL', 'date': '2022-08-17', 'ema': 1665.2670597589909}, {'symbol': 'RAMASTEEL', 'date': '2022-08-18', 'ema': 1536.1225778771823}, {'symbol': 'RAMASTEEL', 'date': '2022-08-19', 'ema': 1432.7109037936411}, {'symbol': 'RAMASTEEL', 'date': '2022-08-22', 'ema': 1306.9479605751992}, {'symbol': 'RAMASTEEL', 'date': '2022-08-23', 'ema': 1408.7338690918468}, {'symbol': 'RAMASTEEL', 'date': '2022-08-24', 'ema': 1348.1068358450043}, {'symbol': 'RAMASTEEL', 'date': '2022-08-25', 'ema': 1270.5014229073847}, {'symbol': 'RAMASTEEL', 'date': '2022-08-26', 'ema': 1180.9060492971576}, {'symbol': 'RAMASTEEL', 'date': '2022-08-29', 'ema': 1071.086425554571}, {'symbol': 'RAMASTEEL', 'date': '2022-08-30', 'ema': 1676.206765977945}, {'symbol': 'RAMASTEEL', 'date': '2022-09-01', 'ema': 1564.2442168371883}, {'symbol': 'RAMASTEEL', 'date': '2022-09-02', 'ema': 1466.2304799955514}, {'symbol': 'RAMASTEEL', 'date': '2022-09-05', 'ema': 1355.6228161864512}, {'symbol': 'RAMASTEEL', 'date': '2022-09-06', 'ema': 1346.5825479782177}, {'symbol': 'RAMASTEEL', 'date': '2022-09-07', 'ema': 1255.9699243612445}, {'symbol': 'RAMASTEEL', 'date': '2022-09-08', 'ema': 1291.6965982316021}, {'symbol': 'RAMASTEEL', 'date': '2022-09-09', 'ema': 1181.830256495259}, {'symbol': 'RAMASTEEL', 'date': '2022-09-12', 'ema': 1137.874993971901}, {'symbol': 'RAMASTEEL', 'date': '2022-09-13', 'ema': 1082.544044069815}, {'symbol': 'RAMASTEEL', 'date': '2022-09-14', 'ema': 994.2731827298327}, {'symbol': 'RAMASTEEL', 'date': '2022-09-15', 'ema': 912.0804986603248}, {'symbol': 'RAMASTEEL', 'date': '2022-09-16', 'ema': 832.1347370736272}, {'symbol': 'RAMASTEEL', 'date': '2022-09-19', 'ema': 1023.6552478285198}, {'symbol': 'RAMASTEEL', 'date': '2022-09-20', 'ema': 1054.4118908924702}, {'symbol': 'RAMASTEEL', 'date': '2022-09-21', 'ema': 992.2107574741398}, {'symbol': 'RAMASTEEL', 'date': '2022-09-22', 'ema': 982.1002081908883}, {'symbol': 'RAMASTEEL', 'date': '2022-09-23', 'ema': 971.2049502679466}, {'symbol': 'RAMASTEEL', 'date': '2022-09-26', 'ema': 953.8520978614755}, {'symbol': 'RAMASTEEL', 'date': '2022-09-27', 'ema': 868.0528503508588}, {'symbol': 'RAMASTEEL', 'date': '2022-09-28', 'ema': 849.914481746015}, {'symbol': 'RAMASTEEL', 'date': '2022-09-29', 'ema': 827.6131025321088}, {'symbol': 'RAMASTEEL', 'date': '2022-09-30', 'ema': 885.7451880052413}, {'symbol': 'RAMASTEEL', 'date': '2022-10-03', 'ema': 1000.2027891475992}, {'symbol': 'RAMASTEEL', 'date': '2022-10-04', 'ema': 958.0739520859231}, {'symbol': 'RAMASTEEL', 'date': '2022-10-06', 'ema': 874.5764326491685}, {'symbol': 'RAMASTEEL', 'date': '2022-10-07', 'ema': 799.6710581111524}, {'symbol': 'RAMASTEEL', 'date': '2022-10-10', 'ema': 804.8785744815189}, {'symbol': 'RAMASTEEL', 'date': '2022-10-11', 'ema': 780.2044235785171}, {'symbol': 'RAMASTEEL', 'date': '2022-10-12', 'ema': 857.5992403805631}, {'symbol': 'RAMASTEEL', 'date': '2022-10-13', 'ema': 847.1945508205094}, {'symbol': 'RAMASTEEL', 'date': '2022-10-14', 'ema': 917.3617364566514}, {'symbol': 'RAMASTEEL', 'date': '2022-10-17', 'ema': 1734.8987139369701}, {'symbol': 'RAMASTEEL', 'date': '2022-10-18', 'ema': 2050.8512078477347}, {'symbol': 'RAMASTEEL', 'date': '2022-10-19', 'ema': 1941.0463309098552}, {'symbol': 'RAMASTEEL', 'date': '2022-10-20', 'ema': 1975.046680347012}, {'symbol': 'RAMASTEEL', 'date': '2022-10-21', 'ema': 1798.4755679330108}, {'symbol': 'RAMASTEEL', 'date': '2022-10-25', 'ema': 1671.5255138441526}, {'symbol': 'RAMASTEEL', 'date': '2022-10-27', 'ema': 1544.1397510970905}, {'symbol': 'RAMASTEEL', 'date': '2022-10-28', 'ema': 1412.226441468796}, {'symbol': 'RAMASTEEL', 'date': '2022-10-31', 'ema': 1296.3477327574824}, {'symbol': 'RAMASTEEL', 'date': '2022-11-01', 'ema': 1433.3860439234365}, {'symbol': 'RAMASTEEL', 'date': '2022-11-02', 'ema': 1455.9492778354902}, {'symbol': 'RAMASTEEL', 'date': '2022-11-03', 'ema': 1445.9041085178244}, {'symbol': 'RAMASTEEL', 'date': '2022-11-04', 'ema': 1321.8560972304124}, {'symbol': 'RAMASTEEL', 'date': '2022-11-07', 'ema': 1198.284087970373}, {'symbol': 'RAMASTEEL', 'date': '2022-11-09', 'ema': 1087.8556034970043}, {'symbol': 'RAMASTEEL', 'date': '2022-11-10', 'ema': 1091.188403163956}, {'symbol': 'RAMASTEEL', 'date': '2022-11-11', 'ema': 1017.4895085769126}, {'symbol': 'RAMASTEEL', 'date': '2022-11-14', 'ema': 929.0524127124447}, {'symbol': 'RAMASTEEL', 'date': '2022-11-15', 'ema': 909.1426591207833}, {'symbol': 'RAMASTEEL', 'date': '2022-11-16', 'ema': 863.7147858711849}, {'symbol': 'RAMASTEEL', 'date': '2022-11-17', 'ema': 793.2838538834529}, {'symbol': 'RAMASTEEL', 'date': '2022-11-18', 'ema': 732.759677323124}, {'symbol': 'RAMASTEEL', 'date': '2022-11-21', 'ema': 1559.3016318637788}, {'symbol': 'RAMASTEEL', 'date': '2022-11-22', 'ema': 1429.4252869243712}, {'symbol': 'RAMASTEEL', 'date': '2022-11-23', 'ema': 1300.0562122649073}, {'symbol': 'RAMASTEEL', 'date': '2022-11-24', 'ema': 1194.8213349063446}, {'symbol': 'RAMASTEEL', 'date': '2022-11-25', 'ema': 1146.4288268200262}, {'symbol': 'RAMASTEEL', 'date': '2022-11-28', 'ema': 1149.4737004562144}, {'symbol': 'RAMASTEEL', 'date': '2022-11-29', 'ema': 1046.9476334603844}, {'symbol': 'RAMASTEEL', 'date': '2022-11-30', 'ema': 982.8145255117764}, {'symbol': 'RAMASTEEL', 'date': '2022-12-01', 'ema': 1546.3559992725595}, {'symbol': 'RAMASTEEL', 'date': '2022-12-02', 'ema': 1483.3554279132682}, {'symbol': 'RAMASTEEL', 'date': '2022-12-05', 'ema': 1355.9358633501}, {'symbol': 'RAMASTEEL', 'date': '2022-12-06', 'ema': 1265.8134001739}, {'symbol': 'RAMASTEEL', 'date': '2022-12-07', 'ema': 1161.4621239668618}, {'symbol': 'RAMASTEEL', 'date': '2022-12-08', 'ema': 1079.8514445414464}, {'symbol': 'RAMASTEEL', 'date': '2022-12-09', 'ema': 1515.9751069660706}, {'symbol': 'RAMASTEEL', 'date': '2022-12-12', 'ema': 1609.863192016921}, {'symbol': 'RAMASTEEL', 'date': '2022-12-13', 'ema': 1527.1333651581667}, {'symbol': 'RAMASTEEL', 'date': '2022-12-14', 'ema': 1492.9539970478652}, {'symbol': 'RAMASTEEL', 'date': '2022-12-15', 'ema': 1374.7155211385448}, {'symbol': 'RAMASTEEL', 'date': '2022-12-16', 'ema': 1555.9807096015404}, {'symbol': 'RAMASTEEL', 'date': '2022-12-19', 'ema': 1417.7434991632986}, {'symbol': 'RAMASTEEL', 'date': '2022-12-20', 'ema': 1340.1536421001274}, {'symbol': 'RAMASTEEL', 'date': '2022-12-21', 'ema': 1285.6580580905916}, {'symbol': 'RAMASTEEL', 'date': '2022-12-22', 'ema': 1390.2953858914875}, {'symbol': 'RAMASTEEL', 'date': '2022-12-23', 'ema': 1362.3482062827743}, {'symbol': 'RAMASTEEL', 'date': '2022-12-26', 'ema': 1289.110279970129}, {'symbol': 'RAMASTEEL', 'date': '2022-12-27', 'ema': 1178.1759675920216}, {'symbol': 'RAMASTEEL', 'date': '2022-12-28', 'ema': 1116.4806373451624}, {'symbol': 'RAMASTEEL', 'date': '2022-12-29', 'ema': 1160.8443861694327}, {'symbol': 'RAMASTEEL', 'date': '2022-12-30', 'ema': 1053.240158915201}]


    # Round for float comparison safety
    actual = test_output.round(2).to_dict(orient="records")
    try:
        assert actual[:len(expected)] == expected
    except AssertionError as e:
        print("Assertion failed:", e)
        raise  # Optional: re-raise the error

def test_rsi_ramasteel_manual():
    input_path = DATA_DIR / "stocks_ohlc_data.parquet"

    df = pd.read_parquet(input_path)
    df = clean_stock_data(df)
    test_output =  calculate_rsi(
        df=df,
        stock_symbol='RAMASTEEL',
        rsi_period=20,
        start_date='2022-07-22',
        end_date='2023-03-31'
    )

    # Expected output based on previous print
    expected = [{'symbol': 'RAMASTEEL', 'date': '2022-07-22', 'rsi': 48.51562148071785}, {'symbol': 'RAMASTEEL', 'date': '2022-07-25', 'rsi': 48.34871586104423}, {'symbol': 'RAMASTEEL', 'date': '2022-07-26', 'rsi': 48.67049415761403}, {'symbol': 'RAMASTEEL', 'date': '2022-07-27', 'rsi': 49.37100182017681}, {'symbol': 'RAMASTEEL', 'date': '2022-07-28', 'rsi': 50.76537933570301}, {'symbol': 'RAMASTEEL', 'date': '2022-07-29', 'rsi': 50.42498007682105}, {'symbol': 'RAMASTEEL', 'date': '2022-08-01', 'rsi': 16.288294956829873}, {'symbol': 'RAMASTEEL', 'date': '2022-08-02', 'rsi': 60.561693045264555}, {'symbol': 'RAMASTEEL', 'date': '2022-08-03', 'rsi': 56.636166429498466}, {'symbol': 'RAMASTEEL', 'date': '2022-08-04', 'rsi': 56.52412924595861}, {'symbol': 'RAMASTEEL', 'date': '2022-08-05', 'rsi': 46.38976030581503}, {'symbol': 'RAMASTEEL', 'date': '2022-08-08', 'rsi': 61.32143459724238}, {'symbol': 'RAMASTEEL', 'date': '2022-08-10', 'rsi': 53.209450028467174}, {'symbol': 'RAMASTEEL', 'date': '2022-08-11', 'rsi': 45.49268404128412}, {'symbol': 'RAMASTEEL', 'date': '2022-08-12', 'rsi': 54.34595662560929}, {'symbol': 'RAMASTEEL', 'date': '2022-08-16', 'rsi': 50.70292076992584}, {'symbol': 'RAMASTEEL', 'date': '2022-08-17', 'rsi': 50.84830888576121}, {'symbol': 'RAMASTEEL', 'date': '2022-08-18', 'rsi': 49.17736035936761}, {'symbol': 'RAMASTEEL', 'date': '2022-08-19', 'rsi': 47.58432148137601}, {'symbol': 'RAMASTEEL', 'date': '2022-08-22', 'rsi': 47.85418267249398}, {'symbol': 'RAMASTEEL', 'date': '2022-08-23', 'rsi': 53.341680196389824}, {'symbol': 'RAMASTEEL', 'date': '2022-08-24', 'rsi': 50.7948310928757}, {'symbol': 'RAMASTEEL', 'date': '2022-08-25', 'rsi': 50.09618000667865}, {'symbol': 'RAMASTEEL', 'date': '2022-08-26', 'rsi': 49.09921739266534}, {'symbol': 'RAMASTEEL', 'date': '2022-08-29', 'rsi': 47.49693810534009}, {'symbol': 'RAMASTEEL', 'date': '2022-08-30', 'rsi': 58.380168323004696}, {'symbol': 'RAMASTEEL', 'date': '2022-09-01', 'rsi': 50.223622956943785}, {'symbol': 'RAMASTEEL', 'date': '2022-09-02', 'rsi': 46.15213318528251}, {'symbol': 'RAMASTEEL', 'date': '2022-09-05', 'rsi': 46.83694796950004}, {'symbol': 'RAMASTEEL', 'date': '2022-09-06', 'rsi': 48.37525944012058}, {'symbol': 'RAMASTEEL', 'date': '2022-09-07', 'rsi': 50.430968530209135}, {'symbol': 'RAMASTEEL', 'date': '2022-09-08', 'rsi': 45.04537022907776}, {'symbol': 'RAMASTEEL', 'date': '2022-09-09', 'rsi': 47.311971260206995}, {'symbol': 'RAMASTEEL', 'date': '2022-09-12', 'rsi': 51.09499182892782}, {'symbol': 'RAMASTEEL', 'date': '2022-09-13', 'rsi': 44.32022073586525}, {'symbol': 'RAMASTEEL', 'date': '2022-09-14', 'rsi': 48.474376224802704}, {'symbol': 'RAMASTEEL', 'date': '2022-09-15', 'rsi': 49.00399493643908}, {'symbol': 'RAMASTEEL', 'date': '2022-09-16', 'rsi': 49.53529116235717}, {'symbol': 'RAMASTEEL', 'date': '2022-09-19', 'rsi': 54.25974339468651}, {'symbol': 'RAMASTEEL', 'date': '2022-09-20', 'rsi': 52.110475087885796}, {'symbol': 'RAMASTEEL', 'date': '2022-09-21', 'rsi': 46.464993695764974}, {'symbol': 'RAMASTEEL', 'date': '2022-09-22', 'rsi': 50.21243969877885}, {'symbol': 'RAMASTEEL', 'date': '2022-09-23', 'rsi': 50.6289716206589}, {'symbol': 'RAMASTEEL', 'date': '2022-09-26', 'rsi': 50.86774555827042}, {'symbol': 'RAMASTEEL', 'date': '2022-09-27', 'rsi': 50.04677216099022}, {'symbol': 'RAMASTEEL', 'date': '2022-09-28', 'rsi': 33.23575467828083}, {'symbol': 'RAMASTEEL', 'date': '2022-09-29', 'rsi': 50.43415050647522}, {'symbol': 'RAMASTEEL', 'date': '2022-09-30', 'rsi': 53.21333197751725}, {'symbol': 'RAMASTEEL', 'date': '2022-10-03', 'rsi': 56.1605906530872}, {'symbol': 'RAMASTEEL', 'date': '2022-10-04', 'rsi': 47.663775089689565}, {'symbol': 'RAMASTEEL', 'date': '2022-10-06', 'rsi': 48.929257280566254}, {'symbol': 'RAMASTEEL', 'date': '2022-10-07', 'rsi': 44.25278329101692}, {'symbol': 'RAMASTEEL', 'date': '2022-10-10', 'rsi': 52.82045249532388}, {'symbol': 'RAMASTEEL', 'date': '2022-10-11', 'rsi': 49.29771773105296}, {'symbol': 'RAMASTEEL', 'date': '2022-10-12', 'rsi': 53.89237428785538}, {'symbol': 'RAMASTEEL', 'date': '2022-10-13', 'rsi': 52.15497647717564}, {'symbol': 'RAMASTEEL', 'date': '2022-10-14', 'rsi': 54.98802347579438}, {'symbol': 'RAMASTEEL', 'date': '2022-10-17', 'rsi': 71.0269868186019}, {'symbol': 'RAMASTEEL', 'date': '2022-10-18', 'rsi': 54.583708417392344}, {'symbol': 'RAMASTEEL', 'date': '2022-10-19', 'rsi': 49.161542864078505}, {'symbol': 'RAMASTEEL', 'date': '2022-10-20', 'rsi': 53.48509299729372}, {'symbol': 'RAMASTEEL', 'date': '2022-10-21', 'rsi': 48.67668031901199}, {'symbol': 'RAMASTEEL', 'date': '2022-10-25', 'rsi': 49.31202421438192}, {'symbol': 'RAMASTEEL', 'date': '2022-10-27', 'rsi': 49.22306944486874}, {'symbol': 'RAMASTEEL', 'date': '2022-10-28', 'rsi': 50.18468170859589}, {'symbol': 'RAMASTEEL', 'date': '2022-10-31', 'rsi': 49.14321363213298}, {'symbol': 'RAMASTEEL', 'date': '2022-11-01', 'rsi': 53.461866387976976}, {'symbol': 'RAMASTEEL', 'date': '2022-11-02', 'rsi': 50.37644061883477}, {'symbol': 'RAMASTEEL', 'date': '2022-11-03', 'rsi': 48.792672908442746}, {'symbol': 'RAMASTEEL', 'date': '2022-11-04', 'rsi': 49.31388014865957}, {'symbol': 'RAMASTEEL', 'date': '2022-11-07', 'rsi': 49.904506620816925}, {'symbol': 'RAMASTEEL', 'date': '2022-11-09', 'rsi': 49.91745307079881}, {'symbol': 'RAMASTEEL', 'date': '2022-11-10', 'rsi': 50.44497111416782}, {'symbol': 'RAMASTEEL', 'date': '2022-11-11', 'rsi': 49.62753672052942}, {'symbol': 'RAMASTEEL', 'date': '2022-11-14', 'rsi': 47.480723716155275}, {'symbol': 'RAMASTEEL', 'date': '2022-11-15', 'rsi': 49.95216877084062}, {'symbol': 'RAMASTEEL', 'date': '2022-11-16', 'rsi': 48.02012532829613}, {'symbol': 'RAMASTEEL', 'date': '2022-11-17', 'rsi': 28.170076413272866}, {'symbol': 'RAMASTEEL', 'date': '2022-11-18', 'rsi': 35.65687547667501}, {'symbol': 'RAMASTEEL', 'date': '2022-11-21', 'rsi': 69.20773955488588}, {'symbol': 'RAMASTEEL', 'date': '2022-11-22', 'rsi': 46.493283184124365}, {'symbol': 'RAMASTEEL', 'date': '2022-11-23', 'rsi': 49.91047455597824}, {'symbol': 'RAMASTEEL', 'date': '2022-11-24', 'rsi': 49.5119765335202}, {'symbol': 'RAMASTEEL', 'date': '2022-11-25', 'rsi': 50.62841408045862}, {'symbol': 'RAMASTEEL', 'date': '2022-11-28', 'rsi': 51.795801954572376}, {'symbol': 'RAMASTEEL', 'date': '2022-11-29', 'rsi': 49.791938802055384}, {'symbol': 'RAMASTEEL', 'date': '2022-11-30', 'rsi': 45.66044578941645}, {'symbol': 'RAMASTEEL', 'date': '2022-12-01', 'rsi': 58.00313523077463}, {'symbol': 'RAMASTEEL', 'date': '2022-12-02', 'rsi': 49.39321409049844}, {'symbol': 'RAMASTEEL', 'date': '2022-12-05', 'rsi': 50.00270446511497}, {'symbol': 'RAMASTEEL', 'date': '2022-12-06', 'rsi': 50.506365773497166}, {'symbol': 'RAMASTEEL', 'date': '2022-12-07', 'rsi': 50.171593364278344}, {'symbol': 'RAMASTEEL', 'date': '2022-12-08', 'rsi': 48.90370238375188}, {'symbol': 'RAMASTEEL', 'date': '2022-12-09', 'rsi': 56.379004254055445}, {'symbol': 'RAMASTEEL', 'date': '2022-12-12', 'rsi': 52.69302464017179}, {'symbol': 'RAMASTEEL', 'date': '2022-12-13', 'rsi': 50.023079327216486}, {'symbol': 'RAMASTEEL', 'date': '2022-12-14', 'rsi': 50.79893166880406}, {'symbol': 'RAMASTEEL', 'date': '2022-12-15', 'rsi': 50.13632095337391}, {'symbol': 'RAMASTEEL', 'date': '2022-12-16', 'rsi': 53.14097745228365}, {'symbol': 'RAMASTEEL', 'date': '2022-12-19', 'rsi': 39.32428747685472}, {'symbol': 'RAMASTEEL', 'date': '2022-12-20', 'rsi': 50.584205939377455}, {'symbol': 'RAMASTEEL', 'date': '2022-12-21', 'rsi': 50.998067468632264}, {'symbol': 'RAMASTEEL', 'date': '2022-12-22', 'rsi': 53.00682630968092}, {'symbol': 'RAMASTEEL', 'date': '2022-12-23', 'rsi': 50.551266215223016}, {'symbol': 'RAMASTEEL', 'date': '2022-12-26', 'rsi': 49.213907008917914}, {'symbol': 'RAMASTEEL', 'date': '2022-12-27', 'rsi': 50.07019607780247}, {'symbol': 'RAMASTEEL', 'date': '2022-12-28', 'rsi': 50.213765242406396}, {'symbol': 'RAMASTEEL', 'date': '2022-12-29', 'rsi': 41.47997547112224}, {'symbol': 'RAMASTEEL', 'date': '2022-12-30', 'rsi': 48.40361406176201}]


    # Round for float comparison safety
    actual = test_output.round(2).to_dict(orient="records")
    try:
        assert actual[:len(expected)] == expected
    except AssertionError as e:
        print("Assertion failed:", e)
        raise  # Optional: re-raise the error


def test_macd_ramasteel_manual():
    input_path = DATA_DIR / "stocks_ohlc_data.parquet"

    df = pd.read_parquet(input_path)
    df = clean_stock_data(df)
    test_output =  calculate_macd(
        df=df,
        stock_symbol='RAMASTEEL',
        fast_period=12, slow_period=26, signal_period=9,
        start_date='2022-07-22',
        end_date='2022-12-31'
    )

    # Expected output based on previous print
    expected = [{'symbol': 'RAMASTEEL', 'date': '2022-07-22', 'macd': -170.4301187252147, 'signal': 43.864177798598554, 'hist': -214.29429652381324}, {'symbol': 'RAMASTEEL', 'date': '2022-07-25', 'macd': -237.43251564915795, 'signal': -12.395160890952745, 'hist': -225.0373547582052}, {'symbol': 'RAMASTEEL', 'date': '2022-07-26', 'macd': -271.5063869069578, 'signal': -64.21740609415376, 'hist': -207.28898081280403}, {'symbol': 'RAMASTEEL', 'date': '2022-07-27', 'macd': -261.951085050169, 'signal': -103.76414188535682, 'hist': -158.1869431648122}, {'symbol': 'RAMASTEEL', 'date': '2022-07-28', 'macd': -197.72512393672832, 'signal': -122.55633829563114, 'hist': -75.16878564109719}, {'symbol': 'RAMASTEEL', 'date': '2022-07-29', 'macd': -180.41959743546613, 'signal': -134.12899012359816, 'hist': -46.29060731186797}, {'symbol': 'RAMASTEEL', 'date': '2022-08-01', 'macd': -229.85920376712136, 'signal': -153.2750328523028, 'hist': -76.58417091481857}, {'symbol': 'RAMASTEEL', 'date': '2022-08-02', 'macd': 0.5001839077031036, 'signal': -122.5199895003016, 'hist': 123.02017340800471}, {'symbol': 'RAMASTEEL', 'date': '2022-08-03', 'macd': 115.46665363689362, 'signal': -74.92266087286256, 'hist': 190.3893145097562}, {'symbol': 'RAMASTEEL', 'date': '2022-08-04', 'macd': 184.56839084766216, 'signal': -23.024450528757626, 'hist': 207.59284137641978}, {'symbol': 'RAMASTEEL', 'date': '2022-08-05', 'macd': 35.74647338205182, 'signal': -11.270265746595737, 'hist': 47.01673912864756}, {'symbol': 'RAMASTEEL', 'date': '2022-08-08', 'macd': 321.3145109986581, 'signal': 55.24668960245502, 'hist': 266.06782139620304}, {'symbol': 'RAMASTEEL', 'date': '2022-08-10', 'macd': 288.2517129945902, 'signal': 101.84769428088207, 'hist': 186.40401871370813}, {'symbol': 'RAMASTEEL', 'date': '2022-08-11', 'macd': 106.29138172650755, 'signal': 102.73643177000717, 'hist': 3.55494995650038}, {'symbol': 'RAMASTEEL', 'date': '2022-08-12', 'macd': 263.31914054807794, 'signal': 134.85297352562134, 'hist': 128.4661670224566}, {'symbol': 'RAMASTEEL', 'date': '2022-08-16', 'macd': 156.83297927668082, 'signal': 139.24897467583324, 'hist': 17.584004600847578}, {'symbol': 'RAMASTEEL', 'date': '2022-08-17', 'macd': 47.23803025462689, 'signal': 120.84678579159197, 'hist': -73.60875553696508}, {'symbol': 'RAMASTEEL', 'date': '2022-08-18', 'macd': -65.85701972281868, 'signal': 83.50602468870984, 'hist': -149.3630444115285}, {'symbol': 'RAMASTEEL', 'date': '2022-08-19', 'macd': -142.4618934120101, 'signal': 38.31244106856586, 'hist': -180.774334480576}, {'symbol': 'RAMASTEEL', 'date': '2022-08-22', 'macd': -227.82739965383257, 'signal': -14.915527075913825, 'hist': -212.91187257791876}, {'symbol': 'RAMASTEEL', 'date': '2022-08-23', 'macd': -111.54878033157001, 'signal': -34.24217772704507, 'hist': -77.30660260452495}, {'symbol': 'RAMASTEEL', 'date': '2022-08-24', 'macd': -147.09460370778493, 'signal': -56.812662923193045, 'hist': -90.28194078459188}, {'symbol': 'RAMASTEEL', 'date': '2022-08-25', 'macd': -192.32515519960293, 'signal': -83.91516137847503, 'hist': -108.4099938211279}, {'symbol': 'RAMASTEEL', 'date': '2022-08-26', 'macd': -241.8040755399203, 'signal': -115.49294421076408, 'hist': -126.31113132915621}, {'symbol': 'RAMASTEEL', 'date': '2022-08-29', 'macd': -301.9011889058112, 'signal': -152.77459314977352, 'hist': -149.12659575603766}, {'symbol': 'RAMASTEEL', 'date': '2022-08-30', 'macd': 244.53271018251758, 'signal': -73.31313248331531, 'hist': 317.8458426658329}, {'symbol': 'RAMASTEEL', 'date': '2022-09-01', 'macd': 117.50191647471206, 'signal': -35.15012269170984, 'hist': 152.6520391664219}, {'symbol': 'RAMASTEEL', 'date': '2022-09-02', 'macd': 19.38944782643466, 'signal': -24.242208588080942, 'hist': 43.631656414515604}, {'symbol': 'RAMASTEEL', 'date': '2022-09-05', 'macd': -76.06777675926901, 'signal': -34.60732222231856, 'hist': -41.46045453695045}, {'symbol': 'RAMASTEEL', 'date': '2022-09-06', 'macd': -73.73918967673785, 'signal': -42.43369571320242, 'hist': -31.305493963535433}, {'symbol': 'RAMASTEEL', 'date': '2022-09-07', 'macd': -140.1211890886948, 'signal': -61.9711943883009, 'hist': -78.14999470039389}, {'symbol': 'RAMASTEEL', 'date': '2022-09-08', 'macd': -91.93875342468732, 'signal': -67.96470619557819, 'hist': -23.974047229109132}, {'symbol': 'RAMASTEEL', 'date': '2022-09-09', 'macd': -172.24096111328913, 'signal': -88.8199571791204, 'hist': -83.42100393416874}, {'symbol': 'RAMASTEEL', 'date': '2022-09-12', 'macd': -186.74963219566052, 'signal': -108.40589218242842, 'hist': -78.34374001323211}, {'symbol': 'RAMASTEEL', 'date': '2022-09-13', 'macd': -209.0233799417274, 'signal': -128.5293897342882, 'hist': -80.4939902074392}, {'symbol': 'RAMASTEEL', 'date': '2022-09-14', 'macd': -256.0968490881702, 'signal': -154.0428816050646, 'hist': -102.0539674831056}, {'symbol': 'RAMASTEEL', 'date': '2022-09-15', 'macd': -292.00971694833856, 'signal': -181.6362486737194, 'hist': -110.37346827461917}, {'symbol': 'RAMASTEEL', 'date': '2022-09-16', 'macd': -321.49347688495675, 'signal': -209.60769431596685, 'hist': -111.8857825689899}, {'symbol': 'RAMASTEEL', 'date': '2022-09-19', 'macd': -119.92497925256407, 'signal': -191.6711513032863, 'hist': 71.74617205072224}, {'symbol': 'RAMASTEEL', 'date': '2022-09-20', 'macd': -80.01320157188513, 'signal': -169.3395613570061, 'hist': 89.32635978512096}, {'symbol': 'RAMASTEEL', 'date': '2022-09-21', 'macd': -123.24000673292721, 'signal': -160.11965043219033, 'hist': 36.87964369926311}, {'symbol': 'RAMASTEEL', 'date': '2022-09-22', 'macd': -117.03320158294127, 'signal': -151.50236066234052, 'hist': 34.46915907939925}, {'symbol': 'RAMASTEEL', 'date': '2022-09-23', 'macd': -112.30042522232043, 'signal': -143.6619735743365, 'hist': 31.361548352016086}, {'symbol': 'RAMASTEEL', 'date': '2022-09-26', 'macd': -113.59069530761951, 'signal': -137.64771792099313, 'hist': 24.05702261337362}, {'symbol': 'RAMASTEEL', 'date': '2022-09-27', 'macd': -172.0225514906017, 'signal': -144.52268463491487, 'hist': -27.499866855686832}, {'symbol': 'RAMASTEEL', 'date': '2022-09-28', 'macd': -166.01329444318787, 'signal': -148.82080659656947, 'hist': -17.192487846618405}, {'symbol': 'RAMASTEEL', 'date': '2022-09-29', 'macd': -164.3471992129554, 'signal': -151.92608511984668, 'hist': -12.421114093108713}, {'symbol': 'RAMASTEEL', 'date': '2022-09-30', 'macd': -95.57635879937766, 'signal': -140.65613985575288, 'hist': 45.079781056375225}, {'symbol': 'RAMASTEEL', 'date': '2022-10-03', 'macd': 11.209072963959443, 'signal': -110.28309729181044, 'hist': 121.49217025576988}, {'symbol': 'RAMASTEEL', 'date': '2022-10-04', 'macd': -27.282216372046605, 'signal': -93.68292110785768, 'hist': 66.40070473581108}, {'symbol': 'RAMASTEEL', 'date': '2022-10-06', 'macd': -95.1396971638228, 'signal': -93.97427631905072, 'hist': -1.1654208447720862}, {'symbol': 'RAMASTEEL', 'date': '2022-10-07', 'macd': -146.68410848314818, 'signal': -104.51624275187022, 'hist': -42.167865731277956}, {'symbol': 'RAMASTEEL', 'date': '2022-10-10', 'macd': -124.2685450611591, 'signal': -108.466703213728, 'hist': -15.801841847431106}, {'symbol': 'RAMASTEEL', 'date': '2022-10-11', 'macd': -129.9040026073369, 'signal': -112.75416309244979, 'hist': -17.14983951488712}, {'symbol': 'RAMASTEEL', 'date': '2022-10-12', 'macd': -49.31350270639541, 'signal': -100.06603101523892, 'hist': 50.75252830884351}, {'symbol': 'RAMASTEEL', 'date': '2022-10-13', 'macd': -52.97834178450228, 'signal': -90.64849316909161, 'hist': 37.67015138458933}, {'symbol': 'RAMASTEEL', 'date': '2022-10-14', 'macd': 11.41163719173312, 'signal': -70.23646709692666, 'hist': 81.64810428865978}, {'symbol': 'RAMASTEEL', 'date': '2022-10-17', 'macd': 693.3290094700744, 'signal': 82.47662821647356, 'hist': 610.8523812536009}, {'symbol': 'RAMASTEEL', 'date': '2022-10-18', 'macd': 864.7796035973213, 'signal': 238.93722329264313, 'hist': 625.8423803046782}, {'symbol': 'RAMASTEEL', 'date': '2022-10-19', 'macd': 657.8388565050232, 'signal': 322.7175499351191, 'hist': 335.12130656990405}, {'symbol': 'RAMASTEEL', 'date': '2022-10-20', 'macd': 599.9019309312289, 'signal': 378.15442613434107, 'hist': 221.74750479688782}, {'symbol': 'RAMASTEEL', 'date': '2022-10-21', 'macd': 374.00944586992273, 'signal': 377.3254300814574, 'hist': -3.315984211534669}, {'symbol': 'RAMASTEEL', 'date': '2022-10-25', 'macd': 220.24343112536735, 'signal': 345.9090302902394, 'hist': -125.66559916487205}, {'symbol': 'RAMASTEEL', 'date': '2022-10-27', 'macd': 86.76956320726435, 'signal': 294.0811368736444, 'hist': -207.31157366638007}, {'symbol': 'RAMASTEEL', 'date': '2022-10-28', 'macd': -32.746938417543106, 'signal': 228.71552181540693, 'hist': -261.46246023295004}, {'symbol': 'RAMASTEEL', 'date': '2022-10-31', 'macd': -123.10434637524077, 'signal': 158.35154817727738, 'hist': -281.45589455251815}, {'symbol': 'RAMASTEEL', 'date': '2022-11-01', 'macd': 10.106850767591368, 'signal': 128.7026086953402, 'hist': -118.59575792774882}, {'symbol': 'RAMASTEEL', 'date': '2022-11-02', 'macd': 29.406143677017553, 'signal': 108.84331569167567, 'hist': -79.43717201465812}, {'symbol': 'RAMASTEEL', 'date': '2022-11-03', 'macd': 18.67845414819726, 'signal': 90.81034338298, 'hist': -72.13188923478273}, {'symbol': 'RAMASTEEL', 'date': '2022-11-04', 'macd': -86.23017467521709, 'signal': 55.40223977134058, 'hist': -141.63241444655768}, {'symbol': 'RAMASTEEL', 'date': '2022-11-07', 'macd': -176.93773008187804, 'signal': 8.934245800696857, 'hist': -185.8719758825749}, {'symbol': 'RAMASTEEL', 'date': '2022-11-09', 'macd': -244.8370086816053, 'signal': -41.82000509576358, 'hist': -203.01700358584174}, {'symbol': 'RAMASTEEL', 'date': '2022-11-10', 'macd': -208.76616426051874, 'signal': -75.2092369287146, 'hist': -133.55692733180413}, {'symbol': 'RAMASTEEL', 'date': '2022-11-11', 'macd': -242.3828390387498, 'signal': -108.64395735072165, 'hist': -133.73888168802816}, {'symbol': 'RAMASTEEL', 'date': '2022-11-14', 'macd': -284.18242431470003, 'signal': -143.75165074351733, 'hist': -140.4307735711827}, {'symbol': 'RAMASTEEL', 'date': '2022-11-15', 'macd': -263.3486816070862, 'signal': -167.67105691623112, 'hist': -95.67762469085505}, {'symbol': 'RAMASTEEL', 'date': '2022-11-16', 'macd': -266.9872180999006, 'signal': -187.53428915296502, 'hist': -79.45292894693557}, {'symbol': 'RAMASTEEL', 'date': '2022-11-17', 'macd': -291.36194283814655, 'signal': -208.29981989000134, 'hist': -83.0621229481452}, {'symbol': 'RAMASTEEL', 'date': '2022-11-18', 'macd': -304.45904121895865, 'signal': -227.5316641557928, 'hist': -76.92737706316584}, {'symbol': 'RAMASTEEL', 'date': '2022-11-21', 'macd': 426.93383544814264, 'signal': -96.63856423500573, 'hist': 523.5723996831484}, {'symbol': 'RAMASTEEL', 'date': '2022-11-22', 'macd': 259.9295631451803, 'signal': -25.324938758968536, 'hist': 285.2545019041488}, {'symbol': 'RAMASTEEL', 'date': '2022-11-23', 'macd': 116.18798670103388, 'signal': 2.977646333031945, 'hist': 113.21034036800194}, {'symbol': 'RAMASTEEL', 'date': '2022-11-24', 'macd': 12.140791393500194, 'signal': 4.810275345125595, 'hist': 7.3305160483746}, {'symbol': 'RAMASTEEL', 'date': '2022-11-25', 'macd': -30.299270928852366, 'signal': -2.2116339096699975, 'hist': -28.087637019182367}, {'symbol': 'RAMASTEEL', 'date': '2022-11-28', 'macd': -23.980809546890896, 'signal': -6.565469037114178, 'hist': -17.41534050977672}, {'symbol': 'RAMASTEEL', 'date': '2022-11-29', 'macd': -106.94120830977715, 'signal': -26.640616891646776, 'hist': -80.30059141813038}, {'symbol': 'RAMASTEEL', 'date': '2022-11-30', 'macd': -146.7404810805881, 'signal': -50.660589729435046, 'hist': -96.07989135115305}, {'symbol': 'RAMASTEEL', 'date': '2022-12-01', 'macd': 344.37849872667516, 'signal': 28.347227961787, 'hist': 316.0312707648882}, {'symbol': 'RAMASTEEL', 'date': '2022-12-02', 'macd': 245.39275927394192, 'signal': 71.756334224218, 'hist': 173.63642504972393}, {'symbol': 'RAMASTEEL', 'date': '2022-12-05', 'macd': 106.05985503862166, 'signal': 78.61703838709873, 'hist': 27.442816651522932}, {'symbol': 'RAMASTEEL', 'date': '2022-12-06', 'macd': 16.763022888001842, 'signal': 66.24623528727936, 'hist': -49.48321239927752}, {'symbol': 'RAMASTEEL', 'date': '2022-12-07', 'macd': -72.49732165038131, 'signal': 38.49752389974723, 'hist': -110.99484555012853}, {'symbol': 'RAMASTEEL', 'date': '2022-12-08', 'macd': -130.8810986915605, 'signal': 4.621799381485683, 'hist': -135.5028980730462}, {'symbol': 'RAMASTEEL', 'date': '2022-12-09', 'macd': 252.01571950912944, 'signal': 54.10058340701444, 'hist': 197.915136102115}, {'symbol': 'RAMASTEEL', 'date': '2022-12-12', 'macd': 297.26576203663126, 'signal': 102.7336191329378, 'hist': 194.53214290369345}, {'symbol': 'RAMASTEEL', 'date': '2022-12-13', 'macd': 188.88370769736184, 'signal': 119.96363684582262, 'hist': 68.92007085153922}, {'symbol': 'RAMASTEEL', 'date': '2022-12-14', 'macd': 135.88313774269386, 'signal': 123.14753702519688, 'hist': 12.735600717496979}, {'symbol': 'RAMASTEEL', 'date': '2022-12-15', 'macd': 19.674906151512914, 'signal': 102.45301085046009, 'hist': -82.77810469894717}, {'symbol': 'RAMASTEEL', 'date': '2022-12-16', 'macd': 169.83854343874714, 'signal': 115.9301173681175, 'hist': 53.908426070629645}, {'symbol': 'RAMASTEEL', 'date': '2022-12-19', 'macd': 32.39514195793345, 'signal': 99.2231222860807, 'hist': -66.82798032814725}, {'symbol': 'RAMASTEEL', 'date': '2022-12-20', 'macd': -35.886442016583715, 'signal': 72.20120942554783, 'hist': -108.08765144213154}, {'symbol': 'RAMASTEEL', 'date': '2022-12-21', 'macd': -75.82003046366594, 'signal': 42.59696144770508, 'hist': -118.41699191137101}, {'symbol': 'RAMASTEEL', 'date': '2022-12-22', 'macd': 22.700604917835562, 'signal': 38.617690141731174, 'hist': -15.917085223895612}, {'symbol': 'RAMASTEEL', 'date': '2022-12-23', 'macd': -3.0761121470031867, 'signal': 30.278929683984302, 'hist': -33.35504183098749}, {'symbol': 'RAMASTEEL', 'date': '2022-12-26', 'macd': -63.40173409641261, 'signal': 11.54279692790492, 'hist': -74.94453102431753}, {'symbol': 'RAMASTEEL', 'date': '2022-12-27', 'macd': -147.35996355425254, 'signal': -20.237755168526576, 'hist': -127.12220838572597}, {'symbol': 'RAMASTEEL', 'date': '2022-12-28', 'macd': -179.066440040546, 'signal': -52.00349214293047, 'hist': -127.06294789761554}, {'symbol': 'RAMASTEEL', 'date': '2022-12-29', 'macd': -117.95280834131108, 'signal': -65.1933553826066, 'hist': -52.759452958704486}, {'symbol': 'RAMASTEEL', 'date': '2022-12-30', 'macd': -192.4779936670808, 'signal': -90.65028303950143, 'hist': -101.82771062757936}]


    # Round for float comparison safety
    actual = test_output.round(2).to_dict(orient="records")
    try:
        assert actual[:len(expected)] == expected
    except AssertionError as e:
        print("Assertion failed:", e)
        raise  # Optional: re-raise the error


def test_bollinger_bands_ramasteel_manual():
    input_path = DATA_DIR / "stocks_ohlc_data.parquet"

    df = pd.read_parquet(input_path)
    df = clean_stock_data(df)
    test_output =  calculate_bollinger_bands(
        df=df,
        stock_symbol='RAMASTEEL',
        period=20, num_std_dev=2,
        start_date='2022-07-22',
        end_date='2022-12-31'
    )

    # Expected output based on previous print
    expected = [{'symbol': 'RAMASTEEL', 'date': '2022-07-22', 'sma': None, 'uboll': None, 'lboll': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-25', 'sma': None, 'uboll': None, 'lboll': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-26', 'sma': None, 'uboll': None, 'lboll': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-27', 'sma': None, 'uboll': None, 'lboll': None}, {'symbol': 'RAMASTEEL', 'date': '2022-07-28', 'sma': 2136.515008, 'uboll': 14039.653820543968, 'lboll': -9766.623804543968}, {'symbol': 'RAMASTEEL', 'date': '2022-07-29', 'sma': 2164.535007, 'uboll': 14054.680820554044, 'lboll': -9725.610806554043}, {'symbol': 'RAMASTEEL', 'date': '2022-08-01', 'sma': 815.387507, 'uboll': 2063.4729606049045, 'lboll': -432.69794660490436}, {'symbol': 'RAMASTEEL', 'date': '2022-08-02', 'sma': 987.325007, 'uboll': 2731.3073948038905, 'lboll': -756.6573808038903}, {'symbol': 'RAMASTEEL', 'date': '2022-08-03', 'sma': 1098.145006, 'uboll': 3013.8362547849533, 'lboll': -817.5462427849534}, {'symbol': 'RAMASTEEL', 'date': '2022-08-04', 'sma': 1207.3100005000001, 'uboll': 3201.420044849032, 'lboll': -786.8000438490319}, {'symbol': 'RAMASTEEL', 'date': '2022-08-05', 'sma': 1141.3650005, 'uboll': 3197.8391356947623, 'lboll': -915.1091346947624}, {'symbol': 'RAMASTEEL', 'date': '2022-08-08', 'sma': 1390.9799905, 'uboll': 4047.0447599117424, 'lboll': -1265.0847789117424}, {'symbol': 'RAMASTEEL', 'date': '2022-08-10', 'sma': 1471.2399905, 'uboll': 4088.8039061011777, 'lboll': -1146.3239251011776}, {'symbol': 'RAMASTEEL', 'date': '2022-08-11', 'sma': 1358.64498555, 'uboll': 4024.8028393662757, 'lboll': -1307.5128682662757}, {'symbol': 'RAMASTEEL', 'date': '2022-08-12', 'sma': 1479.67748555, 'uboll': 4358.939123532403, 'lboll': -1399.584152432403}, {'symbol': 'RAMASTEEL', 'date': '2022-08-16', 'sma': 1500.65998655, 'uboll': 4356.799066795726, 'lboll': -1355.4790936957254}, {'symbol': 'RAMASTEEL', 'date': '2022-08-17', 'sma': 1525.9099850500002, 'uboll': 4339.976731114955, 'lboll': -1288.1567610149546}, {'symbol': 'RAMASTEEL', 'date': '2022-08-18', 'sma': 1501.6874845500001, 'uboll': 4350.417980190602, 'lboll': -1347.0430110906018}, {'symbol': 'RAMASTEEL', 'date': '2022-08-19', 'sma': 1432.71998455, 'uboll': 4314.613979268299, 'lboll': -1449.1740101682994}, {'symbol': 'RAMASTEEL', 'date': '2022-08-22', 'sma': 1371.80248455, 'uboll': 4313.672717564031, 'lboll': -1570.067748464031}, {'symbol': 'RAMASTEEL', 'date': '2022-08-23', 'sma': 1471.0899840499999, 'uboll': 4407.466842521896, 'lboll': -1465.2868744218965}, {'symbol': 'RAMASTEEL', 'date': '2022-08-24', 'sma': 1495.88998555, 'uboll': 4397.951056893393, 'lboll': -1406.1710857933926}, {'symbol': 'RAMASTEEL', 'date': '2022-08-25', 'sma': 1498.89498555, 'uboll': 4396.6182572463, 'lboll': -1398.8282861463008}, {'symbol': 'RAMASTEEL', 'date': '2022-08-26', 'sma': 1470.94248555, 'uboll': 4404.0155288573615, 'lboll': -1462.1305577573614}, {'symbol': 'RAMASTEEL', 'date': '2022-08-29', 'sma': 1394.1999855499998, 'uboll': 4396.66633162741, 'lboll': -1608.2663605274097}, {'symbol': 'RAMASTEEL', 'date': '2022-08-30', 'sma': 1709.41498555, 'uboll': 5738.962827874106, 'lboll': -2320.1328567741057}, {'symbol': 'RAMASTEEL', 'date': '2022-09-01', 'sma': 1719.1924855499997, 'uboll': 5735.319076682987, 'lboll': -2296.9341055829877}, {'symbol': 'RAMASTEEL', 'date': '2022-09-02', 'sma': 1563.67248455, 'uboll': 5505.932877783633, 'lboll': -2378.587908683632}, {'symbol': 'RAMASTEEL', 'date': '2022-09-05', 'sma': 1437.6999850500001, 'uboll': 5371.355086335914, 'lboll': -2495.9551162359144}, {'symbol': 'RAMASTEEL', 'date': '2022-09-06', 'sma': 1371.83999005, 'uboll': 5269.054218734059, 'lboll': -2525.374238634058}, {'symbol': 'RAMASTEEL', 'date': '2022-09-07', 'sma': 1388.59749005, 'uboll': 5264.887277062631, 'lboll': -2487.6922969626307}, {'symbol': 'RAMASTEEL', 'date': '2022-09-08', 'sma': 1214.82500005, 'uboll': 4679.030155604857, 'lboll': -2249.3801555048567}, {'symbol': 'RAMASTEEL', 'date': '2022-09-09', 'sma': 1125.06500055, 'uboll': 4603.8851480126195, 'lboll': -2353.75514691262}, {'symbol': 'RAMASTEEL', 'date': '2022-09-12', 'sma': 1160.1700005, 'uboll': 4605.974101764178, 'lboll': -2285.6341007641777}, {'symbol': 'RAMASTEEL', 'date': '2022-09-13', 'sma': 998.5675014999999, 'uboll': 4221.203920573617, 'lboll': -2224.068917573618}, {'symbol': 'RAMASTEEL', 'date': '2022-09-14', 'sma': 958.8800010000001, 'uboll': 4203.5385174092335, 'lboll': -2285.778515409233}, {'symbol': 'RAMASTEEL', 'date': '2022-09-15', 'sma': 933.250002, 'uboll': 4196.4315875391085, 'lboll': -2329.931583539109}, {'symbol': 'RAMASTEEL', 'date': '2022-09-16', 'sma': 921.4200020999999, 'uboll': 4195.822773374195, 'lboll': -2352.982769174195}, {'symbol': 'RAMASTEEL', 'date': '2022-09-19', 'sma': 1041.0600071000001, 'uboll': 4416.287559409134, 'lboll': -2334.167545209133}, {'symbol': 'RAMASTEEL', 'date': '2022-09-20', 'sma': 1102.7800071, 'uboll': 4451.531589039891, 'lboll': -2245.9715748398903}, {'symbol': 'RAMASTEEL', 'date': '2022-09-21', 'sma': 1004.0600066, 'uboll': 4310.958303205224, 'lboll': -2302.8382900052247}, {'symbol': 'RAMASTEEL', 'date': '2022-09-22', 'sma': 1009.7550051000001, 'uboll': 4315.36373465759, 'lboll': -2295.853724457589}, {'symbol': 'RAMASTEEL', 'date': '2022-09-23', 'sma': 1026.4775051000001, 'uboll': 4325.313435701118, 'lboll': -2272.3584255011174}, {'symbol': 'RAMASTEEL', 'date': '2022-09-26', 'sma': 1049.4400051, 'uboll': 4334.219375462615, 'lboll': -2235.3393652626146}, {'symbol': 'RAMASTEEL', 'date': '2022-09-27', 'sma': 1050.6980050500001, 'uboll': 4333.848806629033, 'lboll': -2232.4527965290326}, {'symbol': 'RAMASTEEL', 'date': '2022-09-28', 'sma': 713.3355040499999, 'uboll': 2045.8239140337305, 'lboll': -619.1529059337307}, {'symbol': 'RAMASTEEL', 'date': '2022-09-29', 'sma': 719.09300405, 'uboll': 2048.7030800783778, 'lboll': -610.5170719783775}, {'symbol': 'RAMASTEEL', 'date': '2022-09-30', 'sma': 764.23800505, 'uboll': 2128.4081940338324, 'lboll': -599.9321839338326}, {'symbol': 'RAMASTEEL', 'date': '2022-10-03', 'sma': 853.37300455, 'uboll': 2320.254967275023, 'lboll': -613.5089581750227}, {'symbol': 'RAMASTEEL', 'date': '2022-10-04', 'sma': 818.23050455, 'uboll': 2277.682200335207, 'lboll': -641.221191235207}, {'symbol': 'RAMASTEEL', 'date': '2022-10-06', 'sma': 802.5405044500001, 'uboll': 2287.664542800393, 'lboll': -682.5835339003927}, {'symbol': 'RAMASTEEL', 'date': '2022-10-07', 'sma': 725.38900445, 'uboll': 2189.4481691393967, 'lboll': -738.6701602393965}, {'symbol': 'RAMASTEEL', 'date': '2022-10-10', 'sma': 761.20150295, 'uboll': 2199.5888125043884, 'lboll': -677.1858066043884}, {'symbol': 'RAMASTEEL', 'date': '2022-10-11', 'sma': 752.47650245, 'uboll': 2194.021953439601, 'lboll': -689.0689485396013}, {'symbol': 'RAMASTEEL', 'date': '2022-10-12', 'sma': 804.2740014499999, 'uboll': 2290.0005436451975, 'lboll': -681.4525407451976}, {'symbol': 'RAMASTEEL', 'date': '2022-10-13', 'sma': 833.90650145, 'uboll': 2288.4810284130876, 'lboll': -620.6680255130877}, {'symbol': 'RAMASTEEL', 'date': '2022-10-14', 'sma': 906.54150145, 'uboll': 2358.4593427542923, 'lboll': -545.376339854292}, {'symbol': 'RAMASTEEL', 'date': '2022-10-17', 'sma': 1377.9840013500002, 'uboll': 5449.608187288497, 'lboll': -2693.6401845884966}, {'symbol': 'RAMASTEEL', 'date': '2022-10-18', 'sma': 1488.44899135, 'uboll': 5837.842256069292, 'lboll': -2860.9442733692913}, {'symbol': 'RAMASTEEL', 'date': '2022-10-19', 'sma': 1466.0139913500002, 'uboll': 5823.110170747437, 'lboll': -2891.0821880474373}, {'symbol': 'RAMASTEEL', 'date': '2022-10-20', 'sma': 1560.85149185, 'uboll': 5902.913790815575, 'lboll': -2781.210807115575}, {'symbol': 'RAMASTEEL', 'date': '2022-10-21', 'sma': 1522.6014923500002, 'uboll': 5903.0018299367, 'lboll': -2857.7988452367003}, {'symbol': 'RAMASTEEL', 'date': '2022-10-25', 'sma': 1502.49149235, 'uboll': 5899.213672546763, 'lboll': -2894.2306878467625}, {'symbol': 'RAMASTEEL', 'date': '2022-10-27', 'sma': 1479.7402426, 'uboll': 5896.670504336598, 'lboll': -2937.1900191365985}, {'symbol': 'RAMASTEEL', 'date': '2022-10-28', 'sma': 1485.04474265, 'uboll': 5895.009644047921, 'lboll': -2924.9201587479215}, {'symbol': 'RAMASTEEL', 'date': '2022-10-31', 'sma': 1460.9397436499999, 'uboll': 5894.694054649273, 'lboll': -2972.814567349274}, {'symbol': 'RAMASTEEL', 'date': '2022-11-01', 'sma': 1566.91474365, 'uboll': 6016.899936839197, 'lboll': -2883.0704495391974}, {'symbol': 'RAMASTEEL', 'date': '2022-11-02', 'sma': 1578.52974365, 'uboll': 6028.310823509641, 'lboll': -2871.25133620964}, {'symbol': 'RAMASTEEL', 'date': '2022-11-03', 'sma': 1541.67599365, 'uboll': 5985.912089175371, 'lboll': -2902.5601018753705}, {'symbol': 'RAMASTEEL', 'date': '2022-11-04', 'sma': 1520.95349315, 'uboll': 5988.309652333448, 'lboll': -2946.4026660334475}, {'symbol': 'RAMASTEEL', 'date': '2022-11-07', 'sma': 1518.1034932500002, 'uboll': 5989.397638754184, 'lboll': -2953.1906522541844}, {'symbol': 'RAMASTEEL', 'date': '2022-11-09', 'sma': 1515.6392433, 'uboll': 5990.304883342362, 'lboll': -2959.0263967423616}, {'symbol': 'RAMASTEEL', 'date': '2022-11-10', 'sma': 1529.0642443000002, 'uboll': 5996.982164909554, 'lboll': -2938.853676309553}, {'symbol': 'RAMASTEEL', 'date': '2022-11-11', 'sma': 1517.6417453000001, 'uboll': 5997.2966524116955, 'lboll': -2962.0131618116948}, {'symbol': 'RAMASTEEL', 'date': '2022-11-14', 'sma': 1442.4442454, 'uboll': 5967.049882649579, 'lboll': -3082.1613918495786}, {'symbol': 'RAMASTEEL', 'date': '2022-11-15', 'sma': 1441.0267454, 'uboll': 5966.56563160396, 'lboll': -3084.51214080396}, {'symbol': 'RAMASTEEL', 'date': '2022-11-16', 'sma': 1383.4367449, 'uboll': 5930.580639416044, 'lboll': -3163.7071496160434}, {'symbol': 'RAMASTEEL', 'date': '2022-11-17', 'sma': 914.5712449, 'uboll': 3406.64342416834, 'lboll': -1577.5009343683398}, {'symbol': 'RAMASTEEL', 'date': '2022-11-18', 'sma': 669.8402499, 'uboll': 2242.819629285186, 'lboll': -903.1391294851859}, {'symbol': 'RAMASTEEL', 'date': '2022-11-21', 'sma': 1095.5177598999999, 'uboll': 5313.086553898889, 'lboll': -3122.0510340988894}, {'symbol': 'RAMASTEEL', 'date': '2022-11-22', 'sma': 990.3952604, 'uboll': 5186.514128758448, 'lboll': -3205.7236079584486}, {'symbol': 'RAMASTEEL', 'date': '2022-11-23', 'sma': 987.8952605499999, 'uboll': 5186.253935284422, 'lboll': -3210.4634141844226}, {'symbol': 'RAMASTEEL', 'date': '2022-11-24', 'sma': 974.3747605499999, 'uboll': 5181.54936472734, 'lboll': -3232.7998436273397}, {'symbol': 'RAMASTEEL', 'date': '2022-11-25', 'sma': 992.0110103, 'uboll': 5190.831280391141, 'lboll': -3206.809259791142}, {'symbol': 'RAMASTEEL', 'date': '2022-11-28', 'sma': 1042.9785103, 'uboll': 5223.935300247427, 'lboll': -3137.978279647427}, {'symbol': 'RAMASTEEL', 'date': '2022-11-29', 'sma': 1036.8510101499999, 'uboll': 5223.3929330568435, 'lboll': -3149.690912756844}, {'symbol': 'RAMASTEEL', 'date': '2022-11-30', 'sma': 918.7660101499999, 'uboll': 5036.261692570285, 'lboll': -3198.7296722702854}, {'symbol': 'RAMASTEEL', 'date': '2022-12-01', 'sma': 1180.25101015, 'uboll': 6087.244502771646, 'lboll': -3726.7424824716454}, {'symbol': 'RAMASTEEL', 'date': '2022-12-02', 'sma': 1156.96976015, 'uboll': 6064.980925947019, 'lboll': -3751.041405647019}, {'symbol': 'RAMASTEEL', 'date': '2022-12-05', 'sma': 1157.0722606499999, 'uboll': 6064.994384021538, 'lboll': -3750.849862721538}, {'symbol': 'RAMASTEEL', 'date': '2022-12-06', 'sma': 1176.33726065, 'uboll': 6068.537937873462, 'lboll': -3715.863416573463}, {'symbol': 'RAMASTEEL', 'date': '2022-12-07', 'sma': 1182.9042605999998, 'uboll': 6069.024364362294, 'lboll': -3703.215843162295}, {'symbol': 'RAMASTEEL', 'date': '2022-12-08', 'sma': 1141.9892600999997, 'uboll': 6043.905639167306, 'lboll': -3759.927118967306}, {'symbol': 'RAMASTEEL', 'date': '2022-12-09', 'sma': 1409.0792546, 'uboll': 6689.324343421573, 'lboll': -3871.1658342215724}, {'symbol': 'RAMASTEEL', 'date': '2022-12-12', 'sma': 1529.7242545000001, 'uboll': 6793.198292154122, 'lboll': -3733.7497831541223}, {'symbol': 'RAMASTEEL', 'date': '2022-12-13', 'sma': 1530.784255, 'uboll': 6793.580182578455, 'lboll': -3732.011672578454}, {'symbol': 'RAMASTEEL', 'date': '2022-12-14', 'sma': 1567.5892555, 'uboll': 6808.284093108101, 'lboll': -3673.105582108101}, {'symbol': 'RAMASTEEL', 'date': '2022-12-15', 'sma': 1573.9522554999999, 'uboll': 6807.572370892365, 'lboll': -3659.667859892366}, {'symbol': 'RAMASTEEL', 'date': '2022-12-16', 'sma': 1729.9632555, 'uboll': 6971.852205889136, 'lboll': -3511.925694889136}, {'symbol': 'RAMASTEEL', 'date': '2022-12-19', 'sma': 1264.6152455, 'uboll': 5098.6345770990765, 'lboll': -2569.4040860990763}, {'symbol': 'RAMASTEEL', 'date': '2022-12-20', 'sma': 1284.987745, 'uboll': 5099.369652360976, 'lboll': -2529.394162360976}, {'symbol': 'RAMASTEEL', 'date': '2022-12-21', 'sma': 1319.83274535, 'uboll': 5100.101993326563, 'lboll': -2460.436502626563}, {'symbol': 'RAMASTEEL', 'date': '2022-12-22', 'sma': 1429.2957453499998, 'uboll': 5199.20644690409, 'lboll': -2340.61495620409}, {'symbol': 'RAMASTEEL', 'date': '2022-12-23', 'sma': 1449.80324535, 'uboll': 5207.146578793028, 'lboll': -2307.5400880930283}, {'symbol': 'RAMASTEEL', 'date': '2022-12-26', 'sma': 1420.55074435, 'uboll': 5195.85765256704, 'lboll': -2354.75616386704}, {'symbol': 'RAMASTEEL', 'date': '2022-12-27', 'sma': 1423.1182445, 'uboll': 5194.634261621746, 'lboll': -2348.3977726217468}, {'symbol': 'RAMASTEEL', 'date': '2022-12-28', 'sma': 1430.9594945, 'uboll': 5193.930027886294, 'lboll': -2332.0110388862945}, {'symbol': 'RAMASTEEL', 'date': '2022-12-29', 'sma': 1165.0744945000001, 'uboll': 3916.4704119892945, 'lboll': -1586.3214229892942}, {'symbol': 'RAMASTEEL', 'date': '2022-12-30', 'sma': 1122.3819945, 'uboll': 3918.224727853718, 'lboll': -1673.4607388537179}]


    # Round for float comparison safety
    actual = test_output.round(2).to_dict(orient="records")
    try:
        assert actual[:len(expected)] == expected
    except AssertionError as e:
        print("Assertion failed:", e)
        raise  # Optional: re-raise the error


if __name__ == "__main__":
    test_sma_ramasteel_manual()